parameters:
  samples: [ 'machines', 'providers', 'provisioners' ]

stages:
  - stage: commit
    displayName: Commit

    jobs:
      - job: build
        displayName: Build

        pool:
          name: Default
          demands:
            - AZP_AGENT_VAGRANT

        workspace:
          clean: all

        steps:
          - checkout: self
            submodules: recursive

          - script: |
              vagrant version
              vagrant plugin list
            displayName: Init

          - ${{ each sample in parameters.samples }}:
            - script: |
                cd ./samples/${{ sample }}
                pwd

                vagrant validate
              displayName: Test - Validate ${{ sample }}
