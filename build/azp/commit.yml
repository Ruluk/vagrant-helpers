parameters:
  samples: [ 'machines', 'providers', 'provisioners' ]

stages:
  - stage: commit
    displayName: Commit

    jobs:
      - ${{ each sample in parameters.samples }}:
        - job: test_${{ sample }}
          displayName: Test ${{ sample }}

          pool:
            name: Default
            demands:
              - AZP_AGENT_VAGRANT

          workspace:
            clean: all

          steps:
            - checkout: self
              submodules: recursive

            - script: |
                vagrant version
                vagrant plugin list
              displayName: Init

            - script: |
                cd ./samples/${{ sample }}
                pwd

                vagrant validate --ignore-provider
              displayName: Test
